import{c as z,j as e,B as h,r,I as Q}from"./index-C4ijDJHY.js";import{C as nt,P as ot}from"./play-chIzS5U0.js";/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lt=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],v=z("loader-circle",lt);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const it=[["path",{d:"M4.9 19.1C1 15.2 1 8.8 4.9 4.9",key:"1vaf9d"}],["path",{d:"M7.8 16.2c-2.3-2.3-2.3-6.1 0-8.5",key:"u1ii0m"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M16.2 7.8c2.3 2.3 2.3 6.1 0 8.5",key:"1j5fej"}],["path",{d:"M19.1 4.9C23 8.8 23 15.1 19.1 19",key:"10b0cb"}]],ct=z("radio",it);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dt=[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]],Ge=z("refresh-cw",dt);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mt=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]],xt=z("square",mt);/**
 * @license lucide-react v0.487.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pt=[["circle",{cx:"10",cy:"7",r:"1",key:"dypaad"}],["circle",{cx:"4",cy:"20",r:"1",key:"22iqad"}],["path",{d:"M4.7 19.3 19 5",key:"1enqfc"}],["path",{d:"m21 3-3 1 2 2Z",key:"d3ov82"}],["path",{d:"M9.26 7.68 5 12l2 5",key:"1esawj"}],["path",{d:"m10 14 5 2 3.5-3.5",key:"v8oal5"}],["path",{d:"m18 12 1-1 1 1-1 1Z",key:"1bh22v"}]],K=z("usb",pt);function Oe({config:i,jointValues:m,extraValues:j={},isConnected:o,pollIntervalMs:S=0,onRefresh:P,isRefreshing:_=!1,error:w,headerActions:F,description:k}){const C=i.jointLabels.length>0?i.jointLabels:Array.from({length:Math.max(m.length,7)},(y,p)=>p<6?`关节${p+1}`:"夹爪"),l=m.length>0?m:Array(C.length).fill(0);return e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(nt,{size:20}),i.label," - 各关节 / 状态参数"]}),k&&e.jsx("p",{className:"text-sm text-gray-500 mb-3",children:k}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-3",children:[F,P&&e.jsxs(h,{type:"button",variant:"outline",size:"sm",onClick:P,disabled:_,children:[_?e.jsx(v,{size:14,className:"animate-spin"}):e.jsx(Ge,{size:14}),e.jsx("span",{className:"ml-1",children:"刷新"})]}),S>0&&e.jsxs("span",{className:"text-xs text-gray-500",children:["每 ",S/1e3," 秒自动更新"]})]}),w&&e.jsx("p",{className:"text-sm text-red-600 mb-2 bg-red-50 px-2 py-1 rounded",children:w}),e.jsx("div",{className:"grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 mb-4",children:C.slice(0,Math.max(C.length,l.length)).map((y,p)=>e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:y}),e.jsx("div",{className:"font-mono text-sm bg-gray-50 border rounded px-3 py-2 min-h-[2.5rem]",children:l[p]!=null?Number(l[p]).toFixed(4):o?"等待数据…":"—"})]},p))}),i.extraParams&&i.extraParams.length>0&&e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 pt-2 border-t border-gray-100",children:i.extraParams.map(({key:y,label:p,isArray:u})=>{const g=j[y],L=u&&Array.isArray(g)?`[ ${g.map(X=>Number(X).toFixed(4)).join(", ")} ]`:typeof g=="number"?g.toFixed(4):"—";return e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:p}),e.jsx("div",{className:"font-mono text-sm bg-gray-50 border rounded px-3 py-2 min-h-[2.5rem] break-all",children:L})]},y)})})]})}const Ue={robot_arm:{kind:"robot_arm",jointLabels:[],extraParams:[{key:"joint_velocities",label:"joint_velocities",isArray:!0},{key:"ee_pos_quat",label:"ee_pos_quat",isArray:!0},{key:"gripper_position",label:"gripper_position",isArray:!1}]},gello:{kind:"gello",jointLabels:["关节1","关节2","关节3","关节4","关节5","关节6","夹爪"],extraParams:[]}},d="http://localhost:8000",G=20,le=20,Ae={joint_positions:[],joint_velocities:[],ee_pos_quat:[],gripper_position:0};function ie(i){const m=o=>Array.isArray(o)?o.map(S=>Number(S)):typeof o=="number"?[o]:[],j=o=>typeof o=="number"?o:Number(o)||0;return{joint_positions:m(i.joint_positions??[]),joint_velocities:m(i.joint_velocities??[]),ee_pos_quat:m(i.ee_pos_quat??[]),gripper_position:j(i.gripper_position??0)}}function ut(){const[i,m]=r.useState(null),[j,o]=r.useState(null),[S,P]=r.useState(!1),[_,w]=r.useState(!1),[F,k]=r.useState(""),[C,l]=r.useState(""),[y,p]=r.useState(null),[u,g]=r.useState(Ae),[L,X]=r.useState("127.0.0.1"),[R,Pe]=r.useState(6001),[x,T]=r.useState("COM3"),[ce,q]=r.useState([]),[de,me]=r.useState(!1),[Re,xe]=r.useState(null),[Te,pe]=r.useState(!1),[E,B]=r.useState([]),[Be,he]=r.useState(!1),[Me,N]=r.useState(""),[J,Y]=r.useState("auto"),[be,ee]=r.useState([]),[ue,ge]=r.useState(!1),[$e,f]=r.useState(null),[te,W]=r.useState(!1),[se,c]=r.useState(""),[O,M]=r.useState("COM4"),[fe,ae]=r.useState([]),[je,ye]=r.useState(!1),[Ie,Ne]=r.useState(null),[ve,Se]=r.useState([]),[re,ne]=r.useState(!1),[U,Z]=r.useState(!1),[we,Le]=r.useState(!1),[A,De]=r.useState(!0),[$,ze]=r.useState(!1),[_e,Fe]=r.useState([]),[qe,Je]=r.useState({}),[ke,I]=r.useState(""),H=r.useCallback(async()=>{try{const t=await fetch(`${d}/api/test/robot/state?host=${encodeURIComponent(L)}&port=${R}`);if(t.ok)return await t.json()}catch{}return null},[L,R]);r.useEffect(()=>{if(i!==!0)return;const t=setInterval(async()=>{const s=await H();s&&g(ie(s))},G);return()=>clearInterval(t)},[i,H]);const Ce=r.useCallback(async()=>{try{const t=await fetch(`${d}/api/test/gello/state?port=${encodeURIComponent(x)}&ids=${encodeURIComponent(J)}`),s=await t.json();t.ok&&s.ok&&Array.isArray(s.joints)&&s.joints.length>0&&(B(s.joints),N(""))}catch{}},[x,J]);r.useEffect(()=>{if(E.length===0)return;const t=setInterval(Ce,le);return()=>clearInterval(t)},[E.length,Ce]);const oe=r.useCallback(async()=>{try{const t=await fetch(`${d}/api/test/teleop/state`);if(!t.ok)return;const s=await t.json();Z(s.running===!0),Array.isArray(s.leader_joints)&&Fe(s.leader_joints),s.follower_obs&&typeof s.follower_obs=="object"&&Je(s.follower_obs),I(s.error||"")}catch{}},[]);r.useEffect(()=>{if(!U)return;const t=setInterval(oe,G);return oe(),()=>clearInterval(t)},[U,oe]);const We=async()=>{pe(!0);try{const t=await H();t&&g(ie(t))}finally{pe(!1)}},Ze=async()=>{ge(!0),N("");try{const s=await(await fetch(`${d}/api/test/gello/scan?port=${encodeURIComponent(x)}`)).json();s.ok&&Array.isArray(s.ids)?(ee(s.ids),s.ids.length===6?Y("1-6"):s.ids.length>=7&&Y("1-7")):(ee([]),N(s.error||"扫描失败"))}catch(t){ee([]),N(t instanceof Error?t.message:"扫描失败")}finally{ge(!1)}},He=async()=>{he(!0),N("");try{const t=await fetch(`${d}/api/test/gello/state?port=${encodeURIComponent(x)}&ids=${encodeURIComponent(J)}`);let s={};try{s=await t.json()}catch{N(`请求异常 (${t.status})，请确认后端已启动`),B([]);return}if(t.ok&&s.ok&&Array.isArray(s.joints))B(s.joints);else{B([]);const n=t.status===404?"接口未找到 (404)：请确认已重启测试后端（重新运行 npm run dev:all 或 python main.py）":s.error||(typeof s.detail=="string"?s.detail:"")||"读取失败";N(Array.isArray(n)?n.join(", "):String(n))}}catch(t){B([]),N(t instanceof Error?t.message:"获取 GELLO 关节状态失败")}finally{he(!1)}},Ve=async()=>{P(!0),k(""),m(null),p(null),g(Ae);try{const s=await(await fetch(`${d}/api/test/robot`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({host:L,port:R})})).json();if(s.ok){m(!0),p(s.num_dofs??null);try{const a=await H();a&&g(ie(a))}catch{}}else m(!1),k(s.error||"连接失败")}catch(t){m(!1),k(t instanceof Error?t.message:"请求失败，请确认测试后端已启动 (端口 8000)")}finally{P(!1)}},Qe=async()=>{w(!0),l(""),o(null);try{const s=await(await fetch(`${d}/api/test/gello`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({port:x})})).json();s.ok?o(!0):(o(!1),l(s.error||"连接失败"))}catch(t){o(!1),l(t instanceof Error?t.message:"请求失败，请确认测试后端已启动")}finally{w(!1)}},Ke=async()=>{ye(!0),c("");try{const s=await(await fetch(`${d}/api/test/gello/ports`)).json();if(Ne(!0),!s.ok||!Array.isArray(s.ports)||s.ports.length===0){ae([]),c(s.error||"未检测到串口");return}const a=s.ports;ae(a);const b=await(await fetch(`${d}/api/test/usb/identify`)).json();if(b.ok&&Array.isArray(b.devices)){const V=b.devices.filter(D=>!D.is_gello);if(V.length>0)M(V[0].port),ne(!1);else{const D=a.find(rt=>rt!==x);M(D??a[0]),c(a.length>1?"未能区分 GELLO/机械臂，已选非 GELLO 串口；若不对请手动选择":"仅检测到一个串口，请确认机械臂已连接")}}else{const V=a.find(D=>D!==x);M(V??a[0]),a.length===1&&(c("仅检测到一个串口，请确认机械臂已连接"),ne(!0))}}catch{Ne(!1),ae([]),c("无法连接后端，请先启动：cd testing-connection/backend && python main.py")}finally{ye(!1)}},Xe=async()=>{W(!0),c(""),f(null);try{const s=await(await fetch(`${d}/api/test/robot/usb`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({port:O,baudrate:115200})})).json();s.ok?f(!0):(f(!1),c(s.error||"连接失败"))}catch(t){f(!1),c(t instanceof Error?t.message:"请求失败，请确认测试后端已启动")}finally{W(!1)}},Ye=async()=>{const t=navigator;if(!t.serial){c("当前浏览器不支持 Web Serial，请使用 Chrome 或 Edge 打开本页"),f(!1);return}if(!window.isSecureContext){c("Web Serial 仅支持安全上下文，请用 http://localhost 访问本页"),f(!1);return}W(!0),c(""),f(null);try{const s=await t.serial.requestPort();await s.open({baudRate:115200}),await s.close(),f(!0)}catch(s){const a=s instanceof Error?s.message:String(s);f(!1),a.includes("No port selected")||a.includes("No device selected")||a.includes("cancel")?c("未选择串口：请再次点击按钮，在弹窗中选中机械臂对应的 COM 口后点击「连接」，不要点取消。"):a.includes("Access denied")||a.includes("Permission")?c("权限被拒绝。请确认在弹窗中选择了正确的 USB 设备。"):a.includes("in use")||a.includes("busy")||a.includes("Error opening")?c("串口被占用。请关闭占用机械臂的其他程序后再试。"):c(`USB 连接失败: ${a}`)}finally{W(!1)}},et=async()=>{me(!0),l("");try{const s=await(await fetch(`${d}/api/test/usb/identify`)).json();if(xe(!0),s.ok&&Array.isArray(s.devices)){const a=s.devices.filter(b=>b.is_gello),n=s.devices.map(b=>b.port);q(n),a.length>0?T(a[0].port):n.length>0?(T(n[0]),l("未识别到 GELLO（Dynamixel 无响应），当前为全部串口，请手动选择")):l("未检测到串口")}else{const n=await(await fetch(`${d}/api/test/gello/ports`)).json();n.ok&&Array.isArray(n.ports)?(q(n.ports),n.ports.length>0&&T(n.ports[0])):(q([]),l(s.error||n.error||"未检测到串口"))}}catch{xe(!1),q([]),l("无法连接后端，请先启动：cd testing-connection/backend && python main.py")}finally{me(!1)}},tt=async()=>{Le(!0),I("");try{const t={gello_port:x,robot_host:L,robot_port:R};A&&(t.robot_usb_port=$?x:O);const s=await fetch(`${d}/api/test/teleop/start`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)}),a=await s.json();if(s.ok&&a.ok)Z(!0);else{const n=typeof a.detail=="string"?a.detail:a.error||"启动失败";I(n)}}catch(t){I(t instanceof Error?t.message:"请求失败")}finally{Le(!1)}},st=async()=>{try{await fetch(`${d}/api/test/teleop/stop`,{method:"POST"}),Z(!1),I("")}catch{Z(!1)}},at=async()=>{const t=navigator;if(!t.serial){l("当前浏览器不支持 Web Serial，请使用 Chrome 或 Edge 打开本页"),o(!1);return}if(!window.isSecureContext){l("Web Serial 仅支持安全上下文，请用 http://localhost 访问本页"),o(!1);return}w(!0),l(""),o(null);try{const s=await t.serial.requestPort();await s.open({baudRate:57600}),await s.close(),o(!0)}catch(s){const a=s instanceof Error?s.message:String(s);o(!1),a.includes("No port selected")||a.includes("No device selected")||a.includes("cancel")?l("未选择串口：请再次点击按钮，在弹窗中选中 GELLO 对应的 COM 口后点击「连接」，不要点取消或直接关掉弹窗。若列表为空，可勾选「显示所有串口」或检查 GELLO 驱动。"):a.includes("Access denied")||a.includes("Permission")?l("权限被拒绝。请确认在弹窗中选择了正确的 USB 设备。"):a.includes("in use")||a.includes("busy")||a.includes("Error opening")?l("串口被占用。请关闭占用 GELLO 的其他程序（如 gello_software、串口助手、Arduino IDE）后再试。"):l(`USB 连接失败: ${a}`)}finally{w(!1)}},Ee=typeof navigator.serial<"u";return e.jsx("div",{className:"flex-1 overflow-y-auto bg-gray-50",children:e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsx("h1",{className:"text-2xl font-semibold text-gray-900 mb-1",children:"测试连接"}),e.jsx("p",{className:"text-sm text-gray-500 mb-6",children:"可单独测试机械臂或 GELLO。机械臂支持 USB 直连或 ZMQ 网络；GELLO 为 USB 串口 (57600)。机械臂 USB 与 GELLO 布局一致，均可「自动检测串口」或「通过浏览器选择」。"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(ct,{size:20}),"机械臂 (ZMQ)"]}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"网络连接，需启动 gello_software 机器人节点"}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"主机"}),e.jsx(Q,{value:L,onChange:t=>X(t.target.value),placeholder:"127.0.0.1",className:"font-mono"}),e.jsx("label",{className:"block text-sm text-gray-700",children:"端口"}),e.jsx(Q,{type:"number",value:R,onChange:t=>Pe(Number(t.target.value)||6001),placeholder:"6001",className:"font-mono"})]}),F&&e.jsx("p",{className:"text-sm text-red-600 mb-2 bg-red-50 px-2 py-1 rounded",children:F}),i===!0&&e.jsxs("p",{className:"text-sm text-green-700 mb-2",children:["已连接 ",y!=null&&`· ${y} 自由度`]}),e.jsx(h,{onClick:Ve,disabled:S,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:S?e.jsx(v,{size:18,className:"animate-spin mx-auto"}):e.jsxs(e.Fragment,{children:[e.jsx(Ge,{size:18,className:"mr-2"}),"测试机械臂连接"]})})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(K,{size:20}),"机械臂 (USB)"]}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"USB 串口直连，默认 115200"}),e.jsxs("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded px-3 py-2 mb-4",children:[e.jsx("strong",{children:"仅连机械臂"}),"：",e.jsx("strong",{children:"通过浏览器选择 USB 设备"})," 不需要后端。",e.jsx("strong",{children:"通过后端测试"})," 需先启动后端；可用 ",e.jsx("code",{className:"bg-amber-100 px-1",children:"npm run dev:all"})," 一键启动前端+测试后端。"]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"串口（后端测试时使用）"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(h,{type:"button",variant:"outline",size:"sm",onClick:Ke,disabled:je,children:je?e.jsx(v,{size:14,className:"animate-spin"}):"自动检测串口"}),fe.length>0&&e.jsx("select",{className:"border rounded px-2 py-1.5 text-sm font-mono bg-white",value:O,onChange:t=>M(t.target.value),children:fe.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx(Q,{value:O,onChange:t=>M(t.target.value),placeholder:"COM4 或 /dev/ttyUSB1",className:"font-mono flex-1 min-w-[120px]"})]}),Ie===!1&&e.jsx("p",{className:"text-xs text-amber-600",children:"未检测到后端，仅「通过浏览器选择 USB 设备」可用"})]}),se&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-red-600 mb-2 bg-red-50 px-2 py-1 rounded",children:se}),se.includes("仅检测到一个串口")&&e.jsxs("div",{className:"mb-3 p-3 bg-gray-50 border border-gray-200 rounded text-sm",children:[e.jsx("button",{type:"button",onClick:async()=>{if(ne(t=>!t),!re)try{const s=await(await fetch(`${d}/api/test/usb/ports/detail`)).json();s.ok&&Array.isArray(s.devices)&&Se(s.devices.map(a=>({port:a.port,description:(a.description||a.hwid||"").trim()||"(无描述)"})))}catch{Se([])}},className:"text-blue-600 hover:underline font-medium",children:re?"收起排查建议":"查看排查建议"}),re&&e.jsxs("div",{className:"mt-2 text-gray-700 space-y-2",children:[e.jsx("p",{children:e.jsx("strong",{children:"当前检测到的串口："})}),ve.length>0?e.jsx("ul",{className:"list-disc pl-5",children:ve.map(t=>e.jsxs("li",{className:"font-mono",children:[t.port," — ",t.description||"(无描述)"]},t.port))}):e.jsx("p",{className:"text-gray-500",children:"加载中…"}),e.jsx("p",{children:e.jsx("strong",{children:"若机械臂未出现为 COM 口，可能原因："})}),e.jsxs("ul",{className:"list-disc pl-5 space-y-1",children:[e.jsx("li",{children:"机械臂需安装 USB 转串口驱动（如 FTDI、CH340、CP210x），请至设备管理器查看是否有黄色感叹号"}),e.jsx("li",{children:"部分机械臂（如 xArm）使用网线连接，不走 USB 串口"}),e.jsx("li",{children:"尝试更换 USB 口或线缆，或使用独立 USB 口（避免与 GELLO 共用一个 Hub）"}),e.jsx("li",{children:"在设备管理器中查看「端口(COM 和 LPT)」下是否有两个 COM 口"})]})]})]})]}),$e===!0&&e.jsx("p",{className:"text-sm text-green-700 mb-2",children:"机械臂 USB 已连接"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(h,{onClick:Xe,disabled:te,variant:"outline",className:"w-full",children:te?e.jsx(v,{size:18,className:"animate-spin mx-auto"}):e.jsx(e.Fragment,{children:"通过后端测试 (指定串口)"})}),Ee&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500 -mt-1",children:"弹窗出现后请选择机械臂的 COM 口并点「连接」，不要取消"}),e.jsx(h,{onClick:Ye,disabled:te,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:"通过浏览器选择 USB 设备（仅连接机械臂）"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-3 flex items-center gap-2",children:[e.jsx(K,{size:20}),"GELLO 控制器 (USB)"]}),e.jsx("p",{className:"text-xs text-gray-500 mb-3",children:"Dynamixel 串口，默认 57600 (gello_software)"}),e.jsxs("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded px-3 py-2 mb-4",children:[e.jsx("strong",{children:"仅连 GELLO"}),"：",e.jsx("strong",{children:"通过浏览器选择 USB 设备"})," 不需要后端。",e.jsx("strong",{children:"通过后端测试"})," 需先启动后端；可用 ",e.jsx("code",{className:"bg-amber-100 px-1",children:"npm run dev:all"})," 一键启动前端+测试后端（打开页面即自动带起后端）。"]}),e.jsxs("div",{className:"space-y-2 mb-4",children:[e.jsx("label",{className:"block text-sm text-gray-700",children:"串口（后端测试时使用）"}),e.jsxs("div",{className:"flex gap-2 flex-wrap",children:[e.jsx(h,{type:"button",variant:"outline",size:"sm",onClick:et,disabled:de,children:de?e.jsx(v,{size:14,className:"animate-spin"}):"自动检测串口"}),ce.length>0&&e.jsx("select",{className:"border rounded px-2 py-1.5 text-sm font-mono bg-white",value:x,onChange:t=>T(t.target.value),children:ce.map(t=>e.jsx("option",{value:t,children:t},t))}),e.jsx(Q,{value:x,onChange:t=>T(t.target.value),placeholder:"COM3 或 /dev/ttyUSB0",className:"font-mono flex-1 min-w-[120px]"})]}),Re===!1&&e.jsx("p",{className:"text-xs text-amber-600",children:"未检测到后端，仅「通过浏览器选择 USB 设备」可用"})]}),C&&e.jsx("p",{className:"text-sm text-red-600 mb-2 bg-red-50 px-2 py-1 rounded",children:C}),j===!0&&e.jsx("p",{className:"text-sm text-green-700 mb-2",children:"串口已就绪"}),e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx(h,{onClick:Qe,disabled:_,variant:"outline",className:"w-full",children:_?e.jsx(v,{size:18,className:"animate-spin mx-auto"}):e.jsx(e.Fragment,{children:"通过后端测试 (指定串口)"})}),Ee&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xs text-gray-500 -mt-1",children:"弹窗出现后请选择 GELLO 的 COM 口并点「连接」，不要取消"}),e.jsx(h,{onClick:at,disabled:_,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",children:"通过浏览器选择 USB 设备（仅连接 GELLO）"})]})]})]})]}),e.jsx("div",{className:"mb-6",children:e.jsx(Oe,{config:{...Ue.robot_arm,label:"机械臂",jointLabels:u.joint_positions.length>0?u.joint_positions.map((t,s)=>s<u.joint_positions.length-1?`关节${s+1}`:"夹爪"):["关节1","关节2","关节3","关节4","关节5","关节6","夹爪"]},jointValues:u.joint_positions,extraValues:{joint_velocities:u.joint_velocities,ee_pos_quat:u.ee_pos_quat,gripper_position:u.gripper_position},isConnected:i===!0,pollIntervalMs:G,onRefresh:We,isRefreshing:Te,description:`get_observations 协议，每 ${G/1e3} 秒实时更新`})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(K,{size:20}),"GELLO - 连接状态"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"USB 串口连接状态"}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"连接状态"}),e.jsx("div",{className:"font-mono text-sm bg-gray-50 border rounded px-3 py-2 min-h-[2.5rem]",children:j===!0?"已连接":j===!1?"未连接":"—"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"当前串口"}),e.jsx("div",{className:"font-mono text-sm bg-gray-50 border rounded px-3 py-2 min-h-[2.5rem]",children:x||"—"})]})]})]}),e.jsx(Oe,{config:{...Ue.gello,label:"GELLO"},jointValues:E,isConnected:j===!0||E.length>0,pollIntervalMs:E.length>0?le:0,onRefresh:He,isRefreshing:Be,error:Me,description:`Dynamixel 各关节（弧度），${E.length>0?`每 ${le/1e3} 秒实时更新`:"连接后点击刷新"}；可扩展机械手等设备`,headerActions:e.jsxs(e.Fragment,{children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"ID 范围："}),e.jsxs("select",{className:"border rounded px-2 py-1.5 text-sm bg-white",value:J,onChange:t=>Y(t.target.value),children:[e.jsx("option",{value:"auto",children:"自动"}),e.jsx("option",{value:"1-7",children:"1–7"}),e.jsx("option",{value:"1-6",children:"1–6"})]}),e.jsx(h,{type:"button",variant:"outline",size:"sm",onClick:Ze,disabled:ue,children:ue?e.jsx(v,{size:14,className:"animate-spin"}):"扫描 ID"}),be.length>0&&e.jsxs("span",{className:"text-sm text-green-700",children:["ID: ",be.join(", ")]})]})}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-6 mb-6",children:[e.jsxs("h2",{className:"text-lg font-medium text-gray-900 mb-2 flex items-center gap-2",children:[e.jsx(K,{size:20}),"GELLO 控制机械臂"]}),e.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"使用 GELLO 控制器作为主手 (leader)，机械臂作为从手 (follower)。机械臂自由度需与 GELLO 一致（通常 7：6 关节 + 夹爪）。"}),e.jsxs("div",{className:"flex flex-wrap items-center gap-3 mb-4",children:[e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:A,onChange:t=>De(t.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm font-medium",children:"使用机械臂 USB 直连（绕过 ZMQ）"})]}),A&&e.jsxs("label",{className:"flex items-center gap-2 cursor-pointer",children:[e.jsx("input",{type:"checkbox",checked:$,onChange:t=>ze(t.target.checked),className:"rounded"}),e.jsx("span",{className:"text-sm font-medium",children:"单口模式（GELLO 与机械臂在同一 Dynamixel 总线）"})]})]}),A?e.jsxs("div",{className:"text-xs text-blue-700 bg-blue-50 border border-blue-200 rounded px-3 py-2 mb-4",children:[e.jsx("strong",{children:"USB 直连模式"}),"：GELLO 和机械臂均通过 USB 连接，无需 quick_run。机械臂需为 Dynamixel 舵机（与 GELLO 同协议）。",$?e.jsxs(e.Fragment,{children:[" ",e.jsx("strong",{children:"单口模式"}),"：GELLO 与机械臂共享同一串口（如 COM3），使用上方 GELLO 的串口即可，无需单独检测机械臂 COM。"]}):e.jsx(e.Fragment,{children:" 使用上方「机械臂 USB」检测到的串口；若机械臂未出现 COM 口，可勾选「单口模式」尝试共享 GELLO 串口。"})]}):e.jsxs("div",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded px-3 py-2 mb-4",children:[e.jsx("strong",{children:"ZMQ 模式"}),"：需先运行 ",e.jsx("code",{className:"bg-amber-100 px-1 rounded",children:"quick_run.py"}),"。机械臂为 xArm(网线) 或 sim_ur(仿真)。"]}),U&&e.jsx("p",{className:"text-xs text-amber-700 bg-amber-50 border border-amber-200 rounded px-3 py-2 mb-3",children:"遥操作运行中，GELLO 串口被占用，上方「GELLO 各关节参数」无法同时读取，此处将显示 Leader/Follower 实时数据。"}),ke&&e.jsx("p",{className:"text-sm text-red-600 mb-3 bg-red-50 px-3 py-2 rounded",children:ke}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs(h,{onClick:tt,disabled:we||U||A&&!$&&!O,className:"bg-green-600 hover:bg-green-700 text-white",title:A&&!$&&!O?"请先在「机械臂 USB」中检测并选择串口，或勾选「单口模式」":void 0,children:[we?e.jsx(v,{size:18,className:"animate-spin mr-2"}):e.jsx(ot,{size:18,className:"mr-2"}),"启动 GELLO 控制"]}),e.jsxs(h,{onClick:st,disabled:!U,variant:"outline",children:[e.jsx(xt,{size:18,className:"mr-2"}),"停止"]})]}),U&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{className:"border rounded-lg p-4 bg-amber-50/50",children:[e.jsx("h3",{className:"font-medium text-amber-800 mb-2",children:"Leader (GELLO)"}),e.jsx("div",{className:"font-mono text-sm space-y-1",children:(_e.length?_e:[0,0,0,0,0,0,0]).map((t,s)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["关节",s+1]}),e.jsx("span",{children:typeof t=="number"?t.toFixed(4):String(t)})]},s))}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["每 ",G/1e3,"s 刷新"]})]}),e.jsxs("div",{className:"border rounded-lg p-4 bg-blue-50/50",children:[e.jsx("h3",{className:"font-medium text-blue-800 mb-2",children:"Follower (机械臂)"}),(()=>{const t=qe,s=Array.isArray(t==null?void 0:t.joint_positions)?t.joint_positions:[],a=typeof(t==null?void 0:t.gripper_position)=="number"?t.gripper_position:0;return e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"font-mono text-sm space-y-1",children:[s.map((n,b)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:["关节",b+1]}),e.jsx("span",{children:typeof n=="number"?n.toFixed(4):String(n)})]},b)),e.jsxs("div",{className:"flex justify-between border-t mt-1 pt-1",children:[e.jsx("span",{children:"夹爪"}),e.jsx("span",{children:typeof a=="number"?a.toFixed(4):String(a)})]})]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:["每 ",G/1e3,"s 刷新"]})]})})()]})]})]}),e.jsxs("p",{className:"mt-4 text-xs text-gray-500",children:["推荐 ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"npm run dev:all"})," 一键启动前端与测试后端；或仅前端 ",e.jsx("code",{className:"bg-gray-100 px-1 rounded",children:"npm run dev"}),"，后端单独运行：",e.jsx("code",{className:"bg-gray-100 px-1 rounded ml-1",children:"cd testing-connection/backend && pip install -r requirements.txt && python main.py"})]})]})})}export{ut as default};
